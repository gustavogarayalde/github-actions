name: "Tag"
inputs:
  app-type:
    description: "spring-boot | npm-ui-lib | android-app"
    required: false
  build-tool:
    description: "maven | npm | gradle"
    required: true
  token:
    description: "Github Token"
    required: true

runs:
  using: "composite"
  steps:
    - name: Git Config
      shell: bash
      run: |
        git config user.email "action@github.com"
        git config user.name "GitHub Action"
        echo "PR_NUMBER=$(echo $GITHUB_REF | awk 'BEGIN { FS = "/" } ; { print $3 }')" >> $GITHUB_ENV

    - uses: actions/checkout@v3
      if: ${{ inputs.app-type == 'npm-ui-lib' }}
      with:
        ref: ${{ github.event.pull_request.head.ref }}

    - name: Tag Version
      if: ${{ inputs.build-tool == 'maven' || inputs.app-type == 'next-js'}}
      shell: bash
      run: git tag -a pr-${{ env.PR_NUMBER }}-$GITHUB_RUN_NUMBER -m "pr-${{ env.PR_NUMBER }}-$GITHUB_RUN_NUMBER"

    - name: Disable git hooks for npm version
      if: ${{ inputs.app-type == 'npm-ui-lib' }}
      shell: bash
      run: git config core.hooksPath /dev/null

    - name: Tag NPM Lib Version
      if: ${{ inputs.app-type == 'npm-ui-lib' }}
      shell: bash
      run: |
        npm version prerelease --preid=pr-${{ env.PR_NUMBER }}
        git push

    - uses: gustavogarayalde/github-actions/actions/tag/pr/gradle@v0.0.18
      if: ${{ inputs.build-tool == 'gradle' }}
      with:
        app-type: ${{ inputs.app-type }}
        build-tool: ${{ inputs.build-tool }}
        token: ${{ inputs.token }}